<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./css/mdb.min.css" />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Google Fonts Roboto -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"
    />

    <style>
      #images_wrapper img {
        width: 150px;
      }
      .time {
        font-size: 14px;
      }
    
    </style>
  </head>
  <body>
    <div class="container my-5">
      <div class="row d-flex justify-content-center text-white">
        <div class="col-lg-6 col-md-8 col-sm-10">
          <div
            id="wrapper-bg"
            class="card bg-image shadow-1-strong"
            style="background-image: url('./images/thunderstorm.gif')"
          >
            <!-- Search -->
            <div class="card-header text-center border-0 mb-3">
              <input class="form-control" type="text" id="search_text" />
              <button class="btn-primary mt-3" id="search">Search</button>
            </div>
            <!--Main current data-->
            <div class="card-header text-center border-0 mb-3">
              <p class="h2 mb-1" id="wrapper-name"></p>
              <p class="mb-1" id="wrapper-description"></p>
              <p class="display-1 mb-1" id="wrapper-temp"></p>
              <span>Pressure : <span id="wrapper-pressure"></span></span>
              <span class="mx-2">|</span>
              <span>Humidity : <span id="wrapper-humidity"></span></span>
            </div>
            <!--Hourly forecast-->
            <div class="card-body border-top border-bottom text-center">
              <div class="row">
                <div class="col-2">
                  <strong class="d-block mb-2">Now</strong>
                  <img id="wrapper-icon-hour-now" src="" alt="" />
                  <strong class="time d-block" id="wrapper-hour-now"></strong>
                </div>
                <div class="col-2">
                  <strong id="wrapper-time1" class="time d-block mb-2"></strong>
                  <img id="wrapper-icon-hour1" src="" alt="" />
                  <strong class="d-block" id="wrapper-hour1"></strong>
                </div>
                <div class="col-2">
                  <strong id="wrapper-time2" class="time d-block mb-2"></strong>
                  <img id="wrapper-icon-hour2" src="" alt="" />
                  <strong class="d-block" id="wrapper-hour2"></strong>
                </div>
                <div class="col-2">
                  <strong id="wrapper-time3" class="time d-block mb-2"></strong>
                  <img id="wrapper-icon-hour3" src="" alt="" />
                  <strong class="d-block" id="wrapper-hour3"></strong>
                </div>
                <div class="col-2">
                  <strong id="wrapper-time4" class="time d-block mb-2"></strong>
                  <img id="wrapper-icon-hour4" src="" alt="" />
                  <strong class="d-block" id="wrapper-hour4"></strong>
                </div>
                <div class="col-2">
                  <strong id="wrapper-time5" class="time d-block mb-2"></strong>
                  <img id="wrapper-icon-hour5" src="" alt="" />
                  <strong class="d-block" id="wrapper-hour5"></strong>
                </div>
              </div>
            </div>
            <!--Daily forecast-->
            <div class="card-body px-5">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Today</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-today" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-today"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Tomorrow</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-tomorrow" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-tomorrow"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Day after Tomorrow</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-dAT" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-dAT"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Third Day</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-thirdday" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-thirdday"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Fourth Day </strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-fourthday" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-fourthday"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Fifth Day</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-fifthday" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-fifthday"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Sixth Day</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-sixthday" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-sixthday"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Seventh Day</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-seventhday" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-seventhday"></span>
                </div>
              </div>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <strong>Eighth Day</strong>
                </div>
                <div class="col-md-2 text-center">
                  <img id="wrapper-icon-eighthday" src="" alt="" />
                </div>
                <div class="col-md-4 text-end">
                  <span id="wrapper-forecast-temp-eighthday"></span>
                </div>
              </div>
            </div>

            <div
              id="images_wrapper"
              class="d-flex justify-content-around"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="./js/mdb.min.js"></script>
    <script type="text/javascript">
      var apiUrl = "https://api.openweathermap.org/data/2.5/";
      // search
      var searchInput = document.getElementById("search_text");
      var searchButton = document.getElementById("search");

      apiCall();

      searchButton.addEventListener("click", (e) => {
        apiCall();
      });

      function formatAMPM(date) {
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var ampm = hours >= 12 ? "pm" : "am";
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        minutes = minutes < 10 ? "0" + minutes : minutes;
        var strTime = hours + ":" + minutes + " " + ampm;
        return strTime;
      }

      function apiCall() {
        let city = searchInput.value != "" ? searchInput.value : "New Delhi";
        // searchInput.value = "New Delhi";
        let queryUrl =
          apiUrl +
          "weather?q=" +
          city +
          "&appid=f5a48b094ac422f580a26d4cd863821b";
        fetch(queryUrl)
          .then((response) => response.json())
          .then((data1) => {
            console.log(data1);

            // flickr call
            let flickrUrl =
              "https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=86e77622d9cc61ba0d91c5e0c3620a28&lat=" +
              data1.coord.lat +
              "&lon=" +
              data1.coord.lon +
              "&format=json&nojsoncallback=1";

            fetch(flickrUrl)
              .then((response) => response.json())
              .then((flickrData) => {
                console.log(flickrData);

                const images_wrapper =
                  document.getElementById("images_wrapper");
                while (images_wrapper.lastElementChild) {
                  images_wrapper.removeChild(images_wrapper.lastElementChild);
                }

                var n = flickrData;
                var _s = n.photos.photo;
                for (var z = 0; z < 4; z++) {
                  var CurrentPhotoUrl =
                    "https://farm" +
                    _s[z]["farm"] +
                    ".staticflickr.com/" +
                    _s[z]["server"] +
                    "/" +
                    _s[z]["id"] +
                    "_" +
                    _s[z]["secret"] +
                    "_n.jpg";
                  console.log(CurrentPhotoUrl);
                  var img = document.createElement("img");
                  img.src = CurrentPhotoUrl;
                  document.getElementById("images_wrapper").appendChild(img);
                }
              });

            //API calls
            let queryUrl = apiUrl + "onecall?";
            let lat = "lat=" + data1.coord.lat + "&";
            let lon = "lon=" + data1.coord.lon + "&";
            let apiOptions = "units=metric&exclude=minutely,alerts&";
            let apiKey = "appid=f5a48b094ac422f580a26d4cd863821b";
            let file = queryUrl + lat + lon + apiOptions + apiKey;

            fetch(file)
              .then((response) => response.json())
              .then((data) => {
                //Weather main data
                let main = data.current.weather[0].main;
                let description = data.current.weather[0].description;
                let temp = Math.round(data.current.temp);
                let pressure = data.current.pressure;
                let humidity = data.current.humidity;
                let name = data1.name;

                document.getElementById("wrapper-description").innerHTML =
                  description;
                document.getElementById("wrapper-temp").innerHTML = temp + "°C";
                document.getElementById("wrapper-pressure").innerHTML =
                  pressure;
                document.getElementById("wrapper-humidity").innerHTML =
                  humidity + "°C";
                document.getElementById("wrapper-name").innerHTML = name;

                //Weather hourly data
                let hourNow = data.hourly[0].temp;
                let hour1 = data.hourly[1].temp;
                let hour2 = data.hourly[2].temp;
                let hour3 = data.hourly[3].temp;
                let hour4 = data.hourly[4].temp;
                let hour5 = data.hourly[5].temp;

                document.getElementById("wrapper-hour-now").innerHTML =
                  hourNow + "°C";
                document.getElementById("wrapper-hour1").innerHTML =
                  hour1 + "°C";
                document.getElementById("wrapper-hour2").innerHTML =
                  hour2 + "°C";
                document.getElementById("wrapper-hour3").innerHTML =
                  hour3 + "°C";
                document.getElementById("wrapper-hour4").innerHTML =
                  hour4 + "°C";
                document.getElementById("wrapper-hour5").innerHTML =
                  hour5 + "°C";

                //Time
                let timeNow = formatAMPM(new Date);
                let time1 = formatAMPM(new Date(new Date().setHours(new Date().getHours() + 1)));
                let time2 = formatAMPM(new Date(new Date().setHours(new Date().getHours() + 2)));
                let time3 = formatAMPM(new Date(new Date().setHours(new Date().getHours() + 3)));
                let time4 = formatAMPM(new Date(new Date().setHours(new Date().getHours() + 4)));
                let time5 = formatAMPM(new Date(new Date().setHours(new Date().getHours() + 5)));
                document.getElementById("wrapper-time1").innerHTML = time1;
                document.getElementById("wrapper-time2").innerHTML = time2;
                document.getElementById("wrapper-time3").innerHTML = time3;
                document.getElementById("wrapper-time4").innerHTML = time4;
                document.getElementById("wrapper-time5").innerHTML = time5;

                //Weather daily data
                let tomorrowTemp = Math.round(data.daily[0].temp.day);
                let dATTemp = Math.round(data.daily[1].temp.day);
                let thirdDayTemp = Math.round(data.daily[2].temp.day);
                let fourthDayTemp = Math.round(data.daily[3].temp.day);
                let fifthDayTemp = Math.round(data.daily[4].temp.day);
                let sixthDayTemp = Math.round(data.daily[5].temp.day);
                let seventhDayTemp = Math.round(data.daily[6].temp.day);
                let eighthDayTemp = Math.round(data.daily[7].temp.day);

                let tommorrowMain = data.daily[0].weather[0].main;
                let dATTempMain = data.daily[1].weather[0].main;
                let thirdDayMain = data.daily[2].weather[0].main;
                let fourthDayMain = data.daily[3].weather[0].main;
                let fifthDayMain = data.daily[4].weather[0].main;
                let sixthDayMain = data.daily[5].weather[0].main;
                let seventhDayMain = data.daily[6].weather[0].main;
                let eighthDayMain = data.daily[7].weather[0].main;

                document.getElementById(
                  "wrapper-forecast-temp-today"
                ).innerHTML = temp + "°C";
                document.getElementById(
                  "wrapper-forecast-temp-tomorrow"
                ).innerHTML = tomorrowTemp + "°C";
                document.getElementById("wrapper-forecast-temp-dAT").innerHTML =
                  dATTemp + "°C";
                document.getElementById(
                  "wrapper-forecast-temp-thirdday"
                ).innerHTML = thirdDayTemp + "°C";
                document.getElementById(
                  "wrapper-forecast-temp-fourthday"
                ).innerHTML = fourthDayTemp + "°C";
                document.getElementById(
                  "wrapper-forecast-temp-fifthday"
                ).innerHTML = fifthDayTemp + "°C";
                document.getElementById(
                  "wrapper-forecast-temp-sixthday"
                ).innerHTML = sixthDayTemp + "°C";
                document.getElementById(
                  "wrapper-forecast-temp-seventhday"
                ).innerHTML = seventhDayTemp + "°C";
                document.getElementById(
                  "wrapper-forecast-temp-eighthday"
                ).innerHTML = eighthDayTemp + "°C";

                //icons
                let iconBaseUrl = "http://openweathermap.org/img/w/";
                let iconFormat = ".png";

                //Today
                let iconCodeToday = data.current.weather[0].icon;
                let iconFullyUrlToday =
                  iconBaseUrl + iconCodeToday + iconFormat;
                document.getElementById("wrapper-icon-today").src =
                  iconFullyUrlToday;

                // Tomorrow
                let iconCodeTomorrow = data.daily[0].weather[0].icon;
                let iconFullyUrlTomorrow =
                  iconBaseUrl + iconCodeTomorrow + iconFormat;
                document.getElementById("wrapper-icon-tomorrow").src =
                  iconFullyUrlTomorrow;

                // Day after tomorrow
                let iconCodeDAT = data.daily[1].weather[0].icon;
                let iconFullyUrlDAT = iconBaseUrl + iconCodeDAT + iconFormat;
                document.getElementById("wrapper-icon-dAT").src =
                  iconFullyUrlDAT;

                // Third day
                let iconCodeThirdday = data.daily[2].weather[0].icon;
                let iconFullyUrlThirdday =
                  iconBaseUrl + iconCodeThirdday + iconFormat;
                document.getElementById("wrapper-icon-thirdday").src =
                  iconFullyUrlThirdday;

                // Fourth day
                let iconCodeFourthday = data.daily[3].weather[0].icon;
                let iconFullyUrlFourthday =
                  iconBaseUrl + iconCodeFourthday + iconFormat;
                document.getElementById("wrapper-icon-fourthday").src =
                  iconFullyUrlFourthday;

                // Fifth day
                let iconCodeFifthday = data.daily[4].weather[0].icon;
                let iconFullyUrlFifthday =
                  iconBaseUrl + iconCodeFifthday + iconFormat;
                document.getElementById("wrapper-icon-fifthday").src =
                  iconFullyUrlFifthday;

                // Sixth day
                let iconCodeSixthday = data.daily[5].weather[0].icon;
                let iconFullyUrlSixthday =
                  iconBaseUrl + iconCodeSixthday + iconFormat;
                document.getElementById("wrapper-icon-sixthday").src =
                  iconFullyUrlSixthday;

                // Seventh day
                let iconCodeSeventhday = data.daily[6].weather[0].icon;
                let iconFullyUrlSeventhday =
                  iconBaseUrl + iconCodeSeventhday + iconFormat;
                document.getElementById("wrapper-icon-seventhday").src =
                  iconFullyUrlSeventhday;

                // eighth day
                let iconCodeEighthday = data.daily[7].weather[0].icon;
                let iconFullyUrlEighthday =
                  iconBaseUrl + iconCodeEighthday + iconFormat;
                document.getElementById("wrapper-icon-eighthday").src =
                  iconFullyUrlEighthday;

                // Icons hourly

                // Hour now
                let iconHourNow = data.hourly[0].weather[0].icon;
                let iconFullyUrlHourNow =
                  iconBaseUrl + iconHourNow + iconFormat;
                document.getElementById("wrapper-icon-hour-now").src =
                  iconFullyUrlHourNow;

                // Hour1
                let iconHour1 = data.hourly[1].weather[0].icon;
                let iconFullyUrlHour1 = iconBaseUrl + iconHour1 + iconFormat;
                document.getElementById("wrapper-icon-hour1").src =
                  iconFullyUrlHour1;

                // Hour2
                let iconHour2 = data.hourly[2].weather[0].icon;
                let iconFullyUrlHour2 = iconBaseUrl + iconHour2 + iconFormat;
                document.getElementById("wrapper-icon-hour2").src =
                  iconFullyUrlHour1;

                // Hour3
                let iconHour3 = data.hourly[3].weather[0].icon;
                let iconFullyUrlHour3 = iconBaseUrl + iconHour3 + iconFormat;
                document.getElementById("wrapper-icon-hour3").src =
                  iconFullyUrlHour3;

                // Hour4
                let iconHour4 = data.hourly[4].weather[0].icon;
                let iconFullyUrlHour4 = iconBaseUrl + iconHour4 + iconFormat;
                document.getElementById("wrapper-icon-hour4").src =
                  iconFullyUrlHour4;

                // Hour5
                let iconHour5 = data.hourly[5].weather[0].icon;
                let iconFullyUrlHour5 = iconBaseUrl + iconHour5 + iconFormat;
                document.getElementById("wrapper-icon-hour5").src =
                  iconFullyUrlHour5;

                //Backgrounds
                switch (main) {
                  case "Snow":
                    document.getElementById(
                      "wrapper-bg"
                    ).style.backgroundImage = "url('./images/snow.gif')";
                    break;

                  case "Clouds":
                    document.getElementById(
                      "wrapper-bg"
                    ).style.backgroundImage = "url('./images/clouds.gif')";
                    break;

                  case "Fog":
                    document.getElementById(
                      "wrapper-bg"
                    ).style.backgroundImage = "url('./images/fog.gif')";
                    break;

                  case "Rain":
                    document.getElementById(
                      "wrapper-bg"
                    ).style.backgroundImage = "url('./images/rain.gif')";
                    break;

                  case "Clear":
                    document.getElementById(
                      "wrapper-bg"
                    ).style.backgroundImage = "url('./images/clear.gif')";
                    break;

                  case "Thunderstorm":
                    document.getElementById(
                      "wrapper-bg"
                    ).style.backgroundImage =
                      "url('./images/thunderstrom.gif')";
                    break;

                  default:
                    document.getElementById(
                      "wrapper-bg"
                    ).style.backgroundImage = "url('./images/clear.gif')";
                    break;
                }
              });
          });
      }
    </script>
  </body>
</html>
